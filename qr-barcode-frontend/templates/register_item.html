{% extends "base.html" %}

{% block title %}Register New Item{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Back Button -->
    <button type="button" class="btn btn-outline-secondary position-absolute top-4 start-4" onclick="history.back()">
        <i class="bi bi-arrow-left"></i> Back
    </button>
    
    <h2 class="text-center mb-4">Register New Item</h2>

    <form action="{{ url_for('create_item') }}" method="post">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="item_name" class="form-label">Item Name</label>
                        <input type="text" class="form-control" id="item_name" name="name" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="revision" class="form-label">Rev No.</label>
                        <select class="form-select" id="revision" name="revision" required>
                            <option value="">Select Revision Number</option>
                            {% for i in range(1, 11) %}
                                <option value="{{ i }}">{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="code_count" class="form-label">No. of Code</label>
                        <select class="form-select" id="code_count" name="code_count" required onchange="updateFields()">
                            <option value="">Select Number of Codes</option>
                            {% for i in range(1, 21) %}
                                <option value="{{ i }}">{{ i }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div id="dynamic-fields">
                    <!-- Dynamic fields will be added here -->
                </div>
            </div>
        </div>
            
        <div class="text-center">
            <button type="submit" class="btn btn-primary px-4 py-2">Next</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.onload = function() {
        {% if preserved_data %}
            document.getElementById('item_name').value = '{{ preserved_data.name|safe|escape }}';
            document.getElementById('revision').value = '{{ preserved_data.revision|safe|escape }}';
            document.getElementById('code_count').value = '{{ preserved_data.code_count|safe|escape }}';
            
            updateFields();
            
            setTimeout(function() {
                {% for i in range(preserved_data.categories|length) %}
                    document.getElementById('category_{{ i + 1 }}').value = '{{ preserved_data.categories[i]|safe|escape }}';
                    document.getElementById('label_content_{{ i + 1 }}').value = '{{ preserved_data.label_contents[i]|safe|escape }}';
                {% endfor %}
            }, 100);
        {% endif %}
    };

    function updateFields() {
        const codeCount = document.getElementById('code_count').value;
        const dynamicFields = document.getElementById('dynamic-fields');
        dynamicFields.innerHTML = '';

        for (let i = 1; i <= codeCount; i++) {
            const codeSection = document.createElement('div');
            codeSection.className = 'card shadow-sm mb-4 mt-4';
            
            codeSection.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title mb-3">Code ${i}</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="category_${i}" class="form-label">Category ${i}</label>
                            <select class="form-select" id="category_${i}" name="category_${i}" required>
                                <option value="">Select Category</option>
                                <option value="Counting">Counting</option>
                                <option value="Non-Counting">Non-Counting</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="label_content_${i}" class="form-label">Label Content ${i}</label>
                            <input type="text" class="form-control" id="label_content_${i}" name="label_content_${i}" required>
                        </div>
                    </div>
                </div>
            `;
            
            dynamicFields.appendChild(codeSection);
        }
    }
</script>
{% endblock %}
